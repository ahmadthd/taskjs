/*
* JavaScript browser Task processing library
* https://github.com/jameswestgate/taskjs
*
* Copyright (c) James Westgate 2012
*
* Dual licensed under the MIT and GPL licenses:
*   http://www.opensource.org/licenses/mit-license.php
*   http://www.gnu.org/licenses/gpl.html
*/
(function(i){i.Task=function(){var c=[],a=-1,e=null,g=this.reset=function(){c=[];a=-1;e=null};this.map=function(b,d){a++;c.length<=a&&(c[a]=[]);c[a].push({f:function(a){b[a]=d(a,b[a])},i:0,a:b});a--};this.reduce=function(b,d,f){a++;a<=c.length&&(e=d,c[a].push({f:function(a){e=f(a,b[a],e)},i:0,a:b}));a--};this.execute=function(b,d){e=null;"undefined"===typeof b&&(b={});"undefined"===typeof b.interval&&(b.interval="20");"undefined"===typeof b.async&&(b.async=!0);"function"!==typeof d&&(d=function(){});
var f=function(){a<c.length-1&&c[a+1].length&&a++;var b=c[a][0];b.f(b.i);b.i++;if(b.i===b.a.length){c[a].shift();if(!c[a].length){c.splice(a,a+1);(!c[a]||!c[a].length)&&a--}}};if(b.async)var h=setTimeout(function(){for(var a=(new Date).getTime()+b.interval;(new Date).getTime()<=a;){if(!c.length){d(e);clearInterval(h);g();return}f()}h=setTimeout(arguments.callee,b.interval)},b.interval);else{for(;c.length;)f();d(e);g()}}}})(window);